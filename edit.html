<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–†–µ–¥–∞–∫—Ç–æ—Ä ‚Äî –ü–∞–¥–∞—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–ö–ì–ë)</title>
  <style>
    :root{
      --ui-acc:#ffd700;
      --ink:#f6f7ff;
      --muted:#c2c6da;
      --stroke:rgba(255,255,255,.16);
      --gap:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family:Rubik,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      display:flex;
      flex-direction:column;
      /* —Ñ–æ–Ω ‚Äì —Å—é–¥–∞ –ø–æ–¥—Å—Ç–∞–≤–∏—à—å —Å–≤–æ–π URL */
      background:
        linear-gradient(135deg,rgba(4,6,20,.92),rgba(9,12,32,.96)),
        url("https://example.com/your-snow-village-bg.jpg") center/cover fixed no-repeat;
    }

    header{
      display:flex; align-items:center; gap:12px;
      padding:16px 20px;
      position:sticky; top:0; z-index:10;
      backdrop-filter:blur(18px);
      background:linear-gradient(135deg,rgba(4,6,20,.92),rgba(9,12,32,.96));
      border-bottom:1px solid rgba(255,255,255,.12);
      box-shadow:0 18px 40px rgba(0,0,0,.55);
    }
    header img{height:42px}
    header h1{
      font-size:20px; margin:0;
      font-weight:800;
      color:var(--ui-acc);
      text-shadow:0 0 18px rgba(0,0,0,.75);
    }

    main{
      display:grid;
      grid-template-columns: 430px 1fr;
      gap:22px;
      padding:20px;
      max-width:1500px;
      width:100%;
      margin:0 auto;
    }

    /* glass‚Äë–∫–∞—Ä—Ç–æ—á–∫–∏ */
    .card{
      background:
        radial-gradient(circle at 0 0, rgba(255,255,255,.12), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(255,255,255,.10), transparent 50%),
        linear-gradient(145deg,rgba(13,18,40,.86),rgba(4,7,18,.88));
      border-radius:18px;
      padding:18px;
      border:1px solid rgba(255,255,255,.16);
      box-shadow:
        0 22px 40px rgba(0,0,0,.65),
        0 0 0 1px rgba(255,255,255,.03) inset;
      backdrop-filter:blur(22px) saturate(130%);
    }
    .card h2{
      margin:0 0 14px;
      font-size:18px;
      color:var(--ui-acc);
      text-shadow:0 0 16px rgba(0,0,0,.6);
    }

    label{
      display:block;
      margin:12px 0 8px;
      font-size:15px;
      color:#fff;
      font-weight:600;
    }

    input[type="text"],
    input[type="number"],
    input[type="url"],
    textarea,
    select{
      width:100%;
      background:linear-gradient(135deg,rgba(8,10,30,.95),rgba(16,20,45,.92));
      color:#fff;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      padding:10px 13px;
      font-size:15px;
      outline:none;
      box-shadow:0 12px 28px rgba(0,0,0,.55);
      transition:border-color .15s ease, box-shadow .15s ease, background .15s ease;
    }
    textarea{min-height:110px; resize:vertical}
    input:focus, textarea:focus, select:focus{
      border-color:var(--ui-acc);
      box-shadow:
        0 0 18px rgba(255,215,0,.35),
        0 12px 30px rgba(0,0,0,.7);
      background:linear-gradient(135deg,rgba(10,12,35,.98),rgba(22,26,60,.96));
    }

    .row{display:grid; grid-template-columns:1fr 1fr; gap:var(--gap)}
    .row-3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:var(--gap)}
    .inline{display:flex; gap:12px; align-items:center}

    .hint{
      color:var(--muted);
      font-size:13px;
      margin-top:6px;
    }

    button{
      background:linear-gradient(120deg,#ffe066,#ffd000);
      color:#222;
      border:none;
      border-radius:999px;
      font-weight:800;
      padding:11px 18px;
      cursor:pointer;
      font-size:15px;
      box-shadow:
        0 14px 30px rgba(0,0,0,.8),
        0 0 18px rgba(255,215,0,.55);
      transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
    }
    button:hover{
      transform:translateY(-1px);
      box-shadow:
        0 18px 40px rgba(0,0,0,.9),
        0 0 24px rgba(255,255,255,.45);
      filter:brightness(1.03);
    }
    .btn-ghost{
      background:linear-gradient(135deg,rgba(10,12,30,.9),rgba(20,24,50,.9));
      color:#f5f5ff;
      border:1px solid rgba(255,255,255,.22);
      box-shadow:0 12px 26px rgba(0,0,0,.7);
    }
    .btn-danger{
      background:linear-gradient(135deg,#ff4b6b,#b30021);
      color:#fff;
    }

    .stack{display:flex; flex-direction:column; gap:var(--gap)}
    .toolbar{display:flex; gap:12px; flex-wrap:wrap}
    .right{display:flex; gap:10px; align-items:center; justify-content:flex-end}

    footer{
      padding:14px 20px;
      color:#c4c7da;
      border-top:1px solid rgba(255,255,255,.18);
      display:flex; align-items:center; justify-content:center; gap:8px;
      backdrop-filter:blur(18px);
      background:linear-gradient(135deg,rgba(5,6,18,.95),rgba(3,5,14,.96));
      box-shadow:0 -18px 40px rgba(0,0,0,.7);
    }
    footer a{color:var(--ui-acc); text-decoration:none}

    /* –ü–†–ï–î–ü–†–û–°–ú–û–¢–† */
    .preview-wrap{display:grid; grid-template-rows:auto 1fr; gap:12px; height:100%}
    .preview-stage{
      background:linear-gradient(145deg,rgba(3,5,18,.9),rgba(11,16,35,.96));
      border-radius:16px;
      border:1px dashed rgba(255,255,255,.25);
      display:flex; align-items:center; justify-content:center;
      padding:24px; min-height:320px;
      box-shadow:0 18px 38px rgba(0,0,0,.8);
      backdrop-filter:blur(18px);
    }
    .preview-controls{display:grid; grid-template-columns:1fr auto; gap:12px}

    .preview-item{
      position:relative;
      display:inline-flex;
      align-items:center; justify-content:center;
      padding:18px 22px;
      min-width:160px; min-height:70px;
      transition:all .2s ease;
      background-size:cover !important;
      background-position:center !important;
      background-repeat:no-repeat !important;
      box-shadow:0 18px 36px rgba(0,0,0,.8);
    }

    /* –∫–æ–ª–æ–Ω–∫–∏ QA */
    .qa-grid{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:16px;
      margin-bottom:10px;
    }
    .qa-col label{
      display:block;
      font-weight:600;
      margin-bottom:4px;
    }
    .qa-col textarea{width:100%; resize:vertical}
    .timer-config{margin:10px 0 4px;}

    /* –†–∞–∑–º–µ—Ä –ø—Ä–µ–≤—å—é —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫) */
    .preview-item{width: var(--cw, auto); height: var(--ch, auto);}
    .preview-item img{
      width:100%; height:100%; object-fit:contain;
    }

    /* –§–ò–ì–£–†–´ */
    .shape-rect{border-radius:10px}
    .shape-rounded{border-radius:20px}
    .shape-circle{border-radius:9999px}
    .shape-diamond{clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);}
    .shape-star{
      clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%,
                         21% 91%, 32% 57%, 2% 35%, 39% 35%);
    }

    /* –≠–§–§–ï–ö–¢–´ */
    .fx-shadow{box-shadow:0 10px 30px rgba(0,0,0,.5)}
    .fx-glow{box-shadow:0 0 18px var(--glow, #00f0ff)}
    .fx-3d{box-shadow:7px 7px 20px rgba(0,0,0,.5), inset -5px -5px 12px rgba(255,255,255,.22)}
    .fx-border{border-style:solid}

    /* –†–ï–ó–£–õ–¨–¢–ê–¢ */
    .result{
      display:grid; grid-template-columns:1fr auto;
      gap:12px; align-items:start;
    }
    .result textarea{
      height:120px;
      font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }
  </style>

  <!-- Google Fonts (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥—Ä—É–∂–∞–µ–º –Ω—É–∂–Ω—ã–π) -->
  <link id="gf" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap">
</head>
<body>
  <header>
    <a href="https://kgbgamecorp.ru" target="_blank" rel="noopener">
      <img src="https://con.xl.ru/fnfLZuvpAUiDaqDs8d1-2g/images/kcJYv7OsYUSGt5AfGq5jIw.png" alt="–ö–ì–ë">
    </a>
    <h1>–†–µ–¥–∞–∫—Ç–æ—Ä –∏–≥—Ä—ã ¬´–ü–∞–¥–∞—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã¬ª ‚Äî –ö–ì–ë</h1>
  </header>

  <main>
    <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê -->
    <section class="card stack">
      <h2>‚öôÔ∏è –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <div class="row">
        <div>
          <label>–Ø–∑—ã–∫ / —Ä–µ–∂–∏–º</label>
          <select id="language"></select>
        </div>
        <div>
          <label>–®—Ä–∏—Ñ—Ç –æ–±—ä–µ–∫—Ç–æ–≤</label>
          <select id="font"></select>
        </div>
      </div>

      <!-- –®—Ä–∏—Ñ—Ç –≤–æ–ø—Ä–æ—Å–∞ -->
      <div class="row">
        <div>
          <label>–®—Ä–∏—Ñ—Ç –≤–æ–ø—Ä–æ—Å–∞ (HUD)</label>
          <select id="qFont"></select>
          <div class="hint">–ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –≤–æ–∑—å–º—ë—Ç—Å—è —à—Ä–∏—Ñ—Ç –æ–±—ä–µ–∫—Ç–æ–≤.</div>
        </div>
        <div>
          <label>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞ (px)</label>
          <input type="number" id="qFontSize" value="26" min="10" max="100">
        </div>
      </div>

      <!-- –°–∫–æ—Ä–æ—Å—Ç—å + –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
      <div class="row">
        <div>
          <label>–°–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è (1‚Äì10)</label>
          <input type="number" id="speed" value="5" min="1" max="10">
        </div>
        <div>
          <label>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è</label>
          <select id="direction">
            <option value="down">–°–≤–µ—Ä—Ö—É –≤–Ω–∏–∑</option>
            <option value="up">–°–Ω–∏–∑—É –≤–≤–µ—Ä—Ö</option>
          </select>
        </div>
      </div>

      <!-- –®—Ä–∏—Ñ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤ -->
      <div class="row">
        <div>
          <label>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –æ–±—ä–µ–∫—Ç–æ–≤ (px)</label>
          <input type="number" id="fontSize" value="24" min="10" max="100">
        </div>
        <div>
          <label>–¶–≤–µ—Ç —à—Ä–∏—Ñ—Ç–∞</label>
          <input type="color" id="textColor" value="#ffffff">
        </div>
      </div>

      <!-- üöÄ –ó–∞–ø—É—Å–∫ –∫–≤–∏–∑–∞ -->
      <div class="card">
        <h2>üöÄ –ó–∞–ø—É—Å–∫ –∫–≤–∏–∑–∞</h2>
        <label>–¢–µ–∫—Å—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (–∑–∞–≥–æ–ª–æ–≤–æ–∫/—Ñ—Ä–∞–∑–∞)</label>
        <input type="text" id="startTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≥—Ä–∞ ¬´–õ–∏—Å—Ç–æ–ø–∞–¥¬ª" />
        <label>–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞</label>
        <input type="text" id="startBtnText" placeholder="–ù–∞—á–∞—Ç—å" />
        <div class="hint">–ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º ‚Äî –≤–æ–∑—å–º—ë—Ç—Å—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.</div>
      </div>

      <!-- üèÅ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–¥–±–µ–∫ -->
      <div class="card">
        <h2>üèÅ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–¥–±–µ–∫</h2>
        <label>–¢–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã</label>
        <textarea id="finalFeedback" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!"></textarea>
        <div class="hint">–ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç (¬´–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!¬ª –∏–ª–∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π).</div>
      </div>

      <!-- –§–æ—Ä–º–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ -->
      <div>
        <label>–§–∏–≥—É—Ä–∞</label>
        <select id="shape">
          <option value="rect">–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫</option>
          <option value="rounded" selected>–°–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–π</option>
          <option value="circle">–ö—Ä—É–≥</option>
          <option value="diamond">–†–æ–º–±</option>
          <option value="star">–ó–≤–µ–∑–¥–∞</option>
        </select>
      </div>

      <!-- –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ -->
      <div>
        <label>–§–æ–Ω ‚Äî —Ü–≤–µ—Ç</label>
        <input type="color" id="bgColor" value="#1a1a1a">
      </div>
      <label>–§–æ–Ω—ã-–¥–µ—Ä–∂–∞—Ç–µ–ª–∏ (–ø–æ –æ–¥–Ω–æ–º—É URL –Ω–∞ —Å—Ç—Ä–æ–∫–µ)</label>
      <textarea id="bgImages" placeholder="https://.../holder1.png
https://.../holder2.png"></textarea>
      <div class="hint">–ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ü–≤–µ—Ç.</div>

      <div class="row-3" style="margin-top:6px">
        <div>
          <label>–†–∞–º–∫–∞ (—Ü–≤–µ—Ç)</label>
          <input type="color" id="borderColor" value="#ffffff">
        </div>
        <div>
          <label>–†–∞–º–∫–∞ (—Ç–æ–ª—â–∏–Ω–∞, px)</label>
          <input type="number" id="borderWidth" value="1" min="0">
        </div>
        <div class="inline" style="align-items:end;">
          <label style="width:100%">–†–∞–º–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞?</label>
          <input type="checkbox" id="borderOn" checked>
        </div>
      </div>

      <div class="row">
        <div class="inline">
          <input type="checkbox" id="shadowOn" checked><label for="shadowOn">–¢–µ–Ω—å</label>
        </div>
        <div class="inline">
          <input type="checkbox" id="glowOn"><label for="glowOn">–ü–æ–¥—Å–≤–µ—Ç–∫–∞</label>
          <input type="color" id="glowColor" value="#00f0ff" title="–¶–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏">
        </div>
      </div>

      <div class="row">
        <div class="inline">
          <input type="checkbox" id="fx3d"><label for="fx3d">3D —ç—Ñ—Ñ–µ–∫—Ç</label>
        </div>
        <div>
          <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ñ–æ–Ω–∞/–∫–∞—Ä—Ç–∏–Ω–∫–∏ (0‚Äì1)</label>
          <input type="text" id="opacity" value="1">
          <div class="hint">–ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω URL —Ñ–æ–Ω–æ–≤–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ ‚Äî —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è. –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –≤–ª–∏—è–µ—Ç –∏ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É, –∏ –Ω–∞ —Ü–≤–µ—Ç.</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã (px)</label>
          <input type="number" id="pad" value="22" min="0" max="120">
        </div>
      </div>

      <div>
        <label>–†–∞–∑–º–µ—Ä –∫–∞—Ä—Ç–∏–Ω–∫–∏ (px)</label>
        <input type="range" id="imgBox" min="80" max="260" value="160" step="10">
        <div class="hint">–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –æ–±—ä–µ–∫—Ç–∞–º-–∫–∞—Ä—Ç–∏–Ω–∫–∞–º. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 160√ó160.</div>
      </div>

      <!-- üß™ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
      <div class="card" style="border-style:dashed">
        <h2>üß™ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h2>
        <div class="preview-controls">
          <input type="text" id="previewValue" placeholder="–¢–µ–∫—Å—Ç –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–ª–∏ URL –∫–∞—Ä—Ç–∏–Ω–∫–∏..." value="Preview">
          <div class="right">
            <button class="btn-ghost" id="btnText">–¢–µ–∫—Å—Ç</button>
            <button class="btn-ghost" id="btnImage">–ö–∞—Ä—Ç–∏–Ω–∫–∞</button>
          </div>
        </div>
        <div class="preview-stage">
          <div id="previewItem" class="preview-item shape-rounded fx-shadow" style="--glow:#00f0ff;">
            <span id="previewText" style="font-weight:800; font-size:24px">Preview</span>
          </div>
        </div>
        <div class="hint">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏. –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω URL –∫–∞—Ä—Ç–∏–Ω–∫–∏ ‚Äî —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.</div>
      </div>
    </section>

    <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê -->
    <section class="card stack">
      <h2>üéØ –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã</h2>
      <div class="qa-grid">
        <div class="qa-col">
          <label for="qCol">–í–æ–ø—Ä–æ—Å—ã</label>
          <textarea id="qCol" rows="12" placeholder="–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å"></textarea>
        </div>
        <div class="qa-col">
          <label for="aCol">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã</label>
          <textarea id="aCol" rows="12" placeholder="–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –æ—Ç–≤–µ—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ —Å–ª–µ–≤–∞, —á–µ—Ä–µ–∑ |&#10;–ù–∞–ø—Ä–∏–º–µ—Ä: cat | cap | map"></textarea>
        </div>
        <div class="qa-col">
          <label for="wCol">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã</label>
          <textarea id="wCol" rows="12" placeholder="–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –Ω–µ–≤–µ—Ä–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ | –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –≤–æ–ø—Ä–æ—Å–∞.&#10;–ï—Å–ª–∏ –ø—É—Å—Ç–æ –∏ –≤–∫–ª—é—á–µ–Ω–∞ –≥–∞–ª–æ—á–∫–∞ —Å–Ω–∏–∑—É ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –±—É–¥—É—Ç –≤–∑—è—Ç—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö."></textarea>
        </div>
      </div>

      <label class="inline">
        <input type="checkbox" id="usePoolForWrong" checked>
        –ë—Ä–∞—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –¥—Ä—É–≥–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤, –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –ø—É—Å—Ç–∞—è
      </label>

      <div class="timer-config">
        <label for="globalTimer">–û–±—â–∏–π —Ç–∞–π–º–µ—Ä (—Å–µ–∫., 0 ‚Äî –±–µ–∑ —Ç–∞–π–º–µ—Ä–∞)</label>
        <input type="number" id="globalTimer" min="0" step="5" value="0">
      </div>

      <h2 style="margin-top:12px">üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è</h2>
      <div class="row">
        <button id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å iframe</button>
        <button id="testBtn" class="btn-ghost">üîç –í–∞–ª–∏–¥–∞—Ü–∏—è JSON</button>
      </div>
      <div class="result" style="margin-top:10px">
        <textarea id="iframeOut" readonly placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è iframe –¥–ª—è Genially"></textarea>
        <button id="copyBtn" class="btn-ghost">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
      <div class="hint">–ü–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø–æ–¥–æ–∂–¥–∞—Ç—å 30‚Äì60 —Å–µ–∫—É–Ω–¥ (–∫–µ—à GitHub Pages).</div>
    </section>
  </main>

  <footer>¬© 2025 <a href="https://kgbgamecorp.ru" target="_blank" rel="noopener">–ö–æ—Ä–ø–æ—Ä–∞—Ü–∏—è –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ë—É–¥—É—â–µ–≥–æ</a></footer>

  <script>
    // ‚Äî‚Äî‚Äî helpers ‚Äî‚Äî‚Äî
    const $  = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);

    // === –Ø–∑—ã–∫–∏ –∏ —à—Ä–∏—Ñ—Ç—ã ===
    const FONT_MAP = {
      ru:   ["PT Sans","Rubik","Lobster","Marck Script","Cormorant","Montserrat","Open Sans","Noto Sans"],
      en:   ["Roboto","Open Sans","Montserrat","Inter","Poppins","Playfair Display","Indie Flower","Special Elite","Anton","Rubik"],
      fr:   ["Noto Sans","Playfair Display","Parisienne","Montserrat","Cormorant","Rubik","Inter"],
      es:   ["Montserrat","Alegreya","Caveat","Roboto","Open Sans","Rubik"],
      de:   ["PT Sans","Rubik","Inter","Montserrat","Open Sans","Playfair Display"],
      zh:   ["Noto Sans SC","ZCOOL XiaoWei","Ma Shan Zheng","Noto Sans"],
      ja:   ["Noto Sans JP","Noto Serif JP","Kosugi Maru","Noto Sans"],
      math:["Latin Modern Math","Rubik"] // math –¥–ª—è LaTeX –≤ –∏–≥—Ä–µ
    };
    const LANG_LABELS = {
      ru:"–†—É—Å—Å–∫–∏–π", en:"English (Latin)", fr:"Fran√ßais", es:"Espa√±ol",
      de:"Deutsch", zh:"‰∏≠Êñá (Chinese)", ja:"Êó•Êú¨Ë™û (Japanese)", math:"–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (LaTeX)"
    };

    function fillLanguageSelect(){
      const sel = $('#language');
      sel.innerHTML = '';
      Object.keys(FONT_MAP).forEach(k=>{
        const opt = document.createElement('option');
        opt.value = k; opt.textContent = LANG_LABELS[k];
        sel.appendChild(opt);
      });
      sel.value = 'ru';
    }

    function fillFontsForLanguage(lang){
      const fonts = (FONT_MAP[lang] || FONT_MAP.en);
      const sel  = $('#font');
      const qSel = $('#qFont');
      sel.innerHTML = '';
      qSel.innerHTML = '';
      fonts.forEach(f=>{
        const opt1 = document.createElement('option');
        opt1.textContent = f;
        sel.appendChild(opt1);
        const opt2 = document.createElement('option');
        opt2.textContent = f;
        qSel.appendChild(opt2);
      });
      sel.value = fonts[0];
      qSel.value = fonts[0];
      applyGoogleFont(sel.value);
    }

    // Google Fonts –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞
    function applyGoogleFont(fontName){
      const gf = document.getElementById('gf');
      const family = fontName.replace(/ /g, '+');
      gf.href = `https://fonts.googleapis.com/css2?family=${family}:wght@400;700&display=swap`;
      const text = $('#previewText');
      text.style.fontFamily = fontName + ", system-ui, sans-serif";
      text.style.fontSize = (parseInt($('#fontSize').value,10)||24) + 'px';
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç –∫–æ –≤—Å–µ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
      document.body.style.fontFamily = fontName + ", system-ui, sans-serif";
    }

    // –ü–∞—Ä—Å–∏–º —Å–ø–∏—Å–æ–∫ —Ñ–æ–Ω–æ–≤ (textarea, —Å—Ç—Ä–æ–∫–∏/–∑–∞–ø—è—Ç—ã–µ)
    function parseBgList(){
      const raw = ($('#bgImages')?.value || '')
        .split(/\n|,/)
        .map(s => s.trim())
        .filter(Boolean);
      return raw.filter(u => /^https?:\/\//i.test(u));
    }

    // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏ ‚Äî –±–µ—Ä—ë–º —Å–ª—É—á–∞–π–Ω—É—é; –∏–Ω–∞—á–µ ‚Äî —Ü–≤–µ—Ç
    function currentPreviewBackground(){
      const list = parseBgList();
      if(list.length){
        const pick = list[Math.floor(Math.random() * list.length)];
        return `url(${pick}) center/contain no-repeat`;
      }
      return $('#bgColor').value;
    }

    // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π
    function updatePreview(){
      const item = $('#previewItem');
      const text = $('#previewText');
      const val  = $('#previewValue').value.trim();
      const asImage = item.dataset.mode === 'image' || /^https?:\/\//i.test(val);

      item.className = 'preview-item';
      item.style.setProperty('--glow', $('#glowColor').value);

      const shape = $('#shape').value;
      item.classList.add('shape-' + shape);

      item.classList.toggle('fx-shadow', $('#shadowOn').checked);
      item.classList.toggle('fx-3d', $('#fx3d').checked);
      item.classList.toggle('fx-glow', $('#glowOn').checked);

      if($('#borderOn').checked && Number($('#borderWidth').value) > 0){
        item.classList.add('fx-border');
        item.style.borderWidth = Number($('#borderWidth').value) + 'px';
        item.style.borderColor = $('#borderColor').value;
      } else {
        item.classList.remove('fx-border');
        item.style.borderWidth = '0px';
        item.style.borderColor = 'transparent';
      }

      item.style.background = currentPreviewBackground();

      const op = Math.max(0, Math.min(1, parseFloat($('#opacity').value || '1')));
      item.style.opacity = op;

      text.style.color = $('#textColor').value;
      text.style.fontSize = (parseInt($('#fontSize').value,10)||24) + 'px';
      text.style.fontFamily = $('#font').value + ", system-ui, sans-serif";

      if(asImage){
        item.dataset.mode = 'image';
        text.style.display = 'none';
        if(!item.querySelector('img')){
          const img = document.createElement('img');
          item.appendChild(img);
        }
        const img = item.querySelector('img');
        img.src = val || 'https://via.placeholder.com/200x140?text=Image';
        const box = Math.max(80, Math.min(260, parseInt($('#imgBox').value||'160',10)));
        item.style.setProperty('--cw', box + 'px');
        item.style.setProperty('--ch', box + 'px');
      } else {
        item.dataset.mode = 'text';
        const img = item.querySelector('img');
        if(img) img.remove();
        text.style.display = 'block';
        text.textContent = val || 'Preview';
        item.style.removeProperty('--cw');
        item.style.removeProperty('--ch');
      }

      const pad = Math.max(0, parseInt($('#pad').value||'22', 10));
      item.style.padding = pad + 'px';
    }

    // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ö–û–ù–§–ò–ì–ê
    function splitLines(text){
      return (text || '')
        .split(/\r?\n/)
        .map(s => s.trim())
        .filter(Boolean);
    }
    function splitByPipe(text){
      return (text || '')
        .split('|')
        .map(s => s.trim())
        .filter(Boolean);
    }

    // —Å–±–æ—Ä —Ñ–æ—Ä–º—ã ‚Üí JSON
    function collectConfig(){
      const qLines = splitLines($('#qCol').value);
      const aLines = splitLines($('#aCol').value);
      const wLines = splitLines($('#wCol').value);
      const usePool = $('#usePoolForWrong').checked;
      const maxLen = Math.max(qLines.length, aLines.length, wLines.length);

      const allCorrect = [];
      for (let i = 0; i < aLines.length; i++){
        allCorrect.push(...splitByPipe(aLines[i]));
      }

      const levels = [];
      for (let i = 0; i < maxLen; i++){
        const q       = (qLines[i] || '').trim();
        const ansRaw  = (aLines[i] || '').trim();
        const wrongRaw= (wLines[i] || '').trim();
        if (!q && !ansRaw) continue;

        const correct = splitByPipe(ansRaw);
        if (!q){
          throw new Error(`–°—Ç—Ä–æ–∫–∞ ${i+1}: –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞`);
        }
        if (correct.length === 0){
          throw new Error(`–°—Ç—Ä–æ–∫–∞ ${i+1}: —É–∫–∞–∂–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (—á–µ—Ä–µ–∑ |)`);
        }
        let wrong = splitByPipe(wrongRaw);
        if (usePool && wrong.length === 0){
          wrong = allCorrect
            .filter(v => !correct.includes(v))
            .sort(() => Math.random() - 0.5)
            .slice(0, Math.max(3, correct.length + 1));
        }
        levels.push({
          target: q,
          correct,
          wrong
        });
      }

      const cfg = {
        language: $('#language').value,
        font: $('#font').value,
        fontSize: Math.max(10, parseInt($('#fontSize').value||'24',10)),
        textColor: $('#textColor').value,
        speed: Math.max(1, Math.min(10, parseInt($('#speed').value||'5',10))),
        questionFont: ($('#qFont')?.value || $('#font').value),
        questionFontSize: Math.max(
          10,
          parseInt($('#qFontSize').value || $('#fontSize').value || '26', 10)
        ),
        style: {
          shape: $('#shape').value,
          pad: Math.max(0, parseInt($('#pad').value||'22',10)),
          bgColor: $('#bgColor').value,
          bgImage: ($('#bgImages')?.value || '').trim(),
          bgImages: parseBgList($('#bgImages')?.value || ''),
          borderOn: $('#borderOn').checked,
          borderColor: $('#borderColor').value,
          borderWidth: Math.max(0, parseInt($('#borderWidth').value||'0', 10)),
          shadow: $('#shadowOn').checked,
          glow: $('#glowOn').checked,
          glowColor: $('#glowColor').value,
          fx3d: $('#fx3d').checked,
          opacity: Math.max(0, Math.min(1, parseFloat($('#opacity').value||'1'))),
          imgBox: Math.max(80, Math.min(260, parseInt($('#imgBox').value||'160',10))),
        },
        randomLevels: false,
        start: {
          title: ($('#startTitle')?.value || '').trim(),
          btnText: ($('#startBtnText')?.value || '').trim()
        },
        direction: (['down','up'].includes($('#direction')?.value) ? $('#direction').value : 'down'),
        finalFeedback: $('#finalFeedback').value.trim(),
        globalTimer: Math.max(0, parseInt($('#globalTimer').value || '0', 10)),
        levels
      };
      return cfg;
    }

    function validate(cfg){
      if (!cfg.levels.length) return '–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å.';
      for (const [i,lv] of cfg.levels.entries()){
        if (!lv.target) return `–°—Ç—Ä–æ–∫–∞ ${i+1}: –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞.`;
        if (!Array.isArray(lv.correct) || lv.correct.length === 0){
          return `–°—Ç—Ä–æ–∫–∞ ${i+1}: —É–∫–∞–∂–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (—á–µ—Ä–µ–∑ |).`;
        }
      }
      return null;
    }

    // –ø—É–±–ª–∏–∫–∞—Ü–∏—è
    const ENDPOINT    = "https://server-kjnn.onrender.com/publish";
    const PUBLISH_KEY = "nika_read_pub_2025";
    const _MAIN   = "https://nikashum93.github.io/snow_quiz/main.html"; // –ø–æ–º–µ–Ω—è–µ—à—å –Ω–∞ —Å–≤–æ–π main.html

    async function publish(){
      let cfg;
      try{
        cfg = collectConfig();
      }catch(e){
        alert(e.message || e);
        return;
      }
      const err = validate(cfg);
      if(err){ alert(err); return; }

      applyGoogleFont(cfg.font);

      const id = makeIdFromFirstTarget(cfg);
      const payload = {
        id,
        mode: "json",
        folder: "data",
        content: JSON.stringify(cfg, null, 2)
      };
      try{
        const res = await fetch(ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-Publish-Key": PUBLISH_KEY
          },
          body: JSON.stringify(payload)
        });
        if(!res.ok){
          const t = await res.text().catch(()=>res.statusText);
          throw new Error(t || 'Server error');
        }
        const iframe = `<iframe src="${_MAIN}?id=${encodeURIComponent(id)}" width="900" height="640" style="border:0;" allow="autoplay" allowfullscreen></iframe>`;
        $('#iframeOut').value = iframe;
        alert('–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ! –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30‚Äì60 —Å–µ–∫—É–Ω–¥ (–∫–µ—à GitHub Pages).');
      }catch(e){
        alert("–°–µ—Ç—å/—Å–µ—Ä–≤–µ—Ä: " + e.message);
      }
    }

    function makeIdFromFirstTarget(cfg){
      const firstTarget = (cfg.levels[0]?.target || 'level').trim();
      const slug = firstTarget.toLowerCase()
        .normalize('NFKD').replace(/[\u0300-\u036f]/g,'')
        .replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'')
        .slice(0,40) || 'level';
      const d=new Date(),p=n=>String(n).padStart(2,'0');
      const stamp = `${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`;
      return `${slug}-${stamp}`;
    }

    function quickTest(){
      let cfg;
      try{
        cfg = collectConfig();
      }catch(e){
        alert(e.message || e);
        return;
      }
      const err = validate(cfg);
      if(err){ alert(err); return; }
      alert('JSON –≤–∞–ª–∏–¥–µ–Ω. –£—Ä–æ–≤–Ω–µ–π: '+cfg.levels.length);
      console.log(cfg);
    }

    function copyIframe(){
      const v = $('#iframeOut').value.trim();
      if(!v){ alert('–°–Ω–∞—á–∞–ª–∞ –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å iframe.'); return; }
      navigator.clipboard.writeText(v).then(()=>{}).catch(()=>{});
    }

    // ‚Äî‚Äî‚Äî UI —Å–æ–±—ã—Ç–∏—è ‚Äî‚Äî‚Äî
    $('#language').addEventListener('change', e=>{
      fillFontsForLanguage(e.target.value);
      updatePreview();
    });
    $('#font').addEventListener('change', e=> { applyGoogleFont(e.target.value); updatePreview(); });
    $('#fontSize').addEventListener('input', ()=> { applyGoogleFont($('#font').value); updatePreview(); });

    [
      'textColor','opacity','shape','bgColor','bgImages','borderColor','borderWidth','borderOn',
      'shadowOn','glowOn','glowColor','fx3d','previewValue','speed','pad',
      'direction','startTitle','startBtnText','imgBox','qFont','qFontSize'
    ].forEach(id => {
      if($('#'+id)){
        $('#'+id).addEventListener('input', updatePreview);
        $('#'+id).addEventListener('change', updatePreview);
      }
    });

    $('#btnText').onclick = (e)=>{
      e.preventDefault();
      const it=$('#previewItem');
      it.dataset.mode='text';
      updatePreview();
    };
    $('#btnImage').onclick= (e)=>{
      e.preventDefault();
      const it=$('#previewItem');
      it.dataset.mode='image';
      updatePreview();
    };

    $('#saveBtn').addEventListener('click', publish);
    $('#testBtn').addEventListener('click', quickTest);
    $('#copyBtn').addEventListener('click', copyIframe);

    // init
    fillLanguageSelect();
    fillFontsForLanguage($('#language').value);
    applyGoogleFont($('#font').value);
    updatePreview();
  </script>
</body>
</html>
